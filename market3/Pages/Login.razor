@page "/Login"
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
<h3>Авторизация</h3>
<EditForm Model="loginModel" OnInvalidSubmit="@HandleLogin">
    <p>
        <div>
            <label> Имя пользователя</label>
            <InputText @bind-Value="@loginModel.Name" />
        </div>
    </p>
    <p>
        <div>
            <label> Пароль</label>
            <InputText @bind-Value="@loginModel.Password" />
        </div>
    </p>

    <button type="submit">Авторизация</button>
</EditForm>
@code {
    public class LoginModel
    {
        public string Name { get; set; } = "";
        public string Password { get; set; } = "";
    }
    private LoginModel loginModel = new LoginModel();
    private HubConnection hubConnection;
    protected override async Task OnInitializedAsync()
    {
        var hubConnection = new HubConnectionBuilder().WithUrl("http://localhost:5122/producthub").Build();

        hubConnection.On("LoginResult", (bool success) =>
        {
            JSRuntime.InvokeVoidAsync("localStorage.setItem", "name", loginModel.Name);
            NavigationManager.NavigateTo("/");
        });
        await hubConnection.StartAsync();
    }

    private async Task HandleLogin()
    {
        await hubConnection.SendAsync("login", loginModel.Name, loginModel.Password);
    }
    public void Disponse()
    {
        hubConnection?.DisposeAsync();
    }
}
